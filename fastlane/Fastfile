fastlane_version "2.55.0"
default_platform :mac

platform :mac do

  before_all do
    unless ENV["CI"]
      ensure_git_status_clean
    end
  end

  desc "Run tests"
  lane :test do
    scan(scheme: "SwiftBeanCount")
  end

  desc "Install dependencies"
  lane :dependencies do
    carthage(command: "bootstrap", use_ssh: true, cache_builds: true)
  end

  desc "Run linter"
  lane :lint do
    swiftlint(strict: true, config_file: ".swiftlint.yml")
  end

  lane :ci do
    dependencies
    lint
    test
  end

  after_all do |lane|
    notification(message: "Fastlane finished '#{lane}'")
  end

end
